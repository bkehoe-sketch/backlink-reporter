name: Monthly Backlink Report

on:
  schedule:
    # Runs at 9 AM UTC on the 1st of every month
    - cron: '0 9 1 * *'
  workflow_dispatch:  # Allows manual trigger for testing

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Create directories
      run: |
        mkdir -p data
        mkdir -p reports
        
    - name: Collect backlink data
      env:
        TARGET_DOMAIN: ${{ secrets.TARGET_DOMAIN }}
        RAPIDAPI_KEY: ${{ secrets.RAPIDAPI_KEY }}
      run: python scripts/collect_data.py
      
    - name: Generate report
      env:
        TARGET_DOMAIN: ${{ secrets.TARGET_DOMAIN }}
      run: python scripts/generate_report.py
      
    - name: Send email report
      env:
        EMAIL_FROM: ${{ secrets.EMAIL_FROM }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_TO: ${{ secrets.EMAIL_TO }}
      run: python scripts/send_email.py
      
    - name: Commit and push data
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add data/*.csv
        git add reports/*.html
        git diff --quiet && git diff --staged --quiet || git commit -m "Update backlink data - $(date +'%Y-%m-%d')"
        git push
```

5. **Scroll down to "Commit new file"**

6. **Add commit message:** `Add GitHub Actions workflow`

7. **Click "Commit new file"**

---

## **âœ… How to Verify It Worked**

After creating the file, you should see:

1. **In your repository root, you'll see:**
```
   ğŸ“ .github
   ğŸ“ config
   ğŸ“ scripts
   ğŸ“„ requirements.txt
   ğŸ“„ README.md
```

2. **Click on the `.github` folder**, you'll see:
```
   ğŸ“ workflows
```

3. **Click on `workflows`**, you'll see:
```
   ğŸ“„ monthly_report.yml
```

4. **A new "Actions" tab appears** at the top of your repository:
```
   Code  Issues  Pull requests  Actions  â† This should appear!
```

---

## **ğŸ¬ Visual Guide**

Here's exactly what you should see on your screen:

### **Step 1: Click "Add file"**
```
On GitHub repository page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backlink-reporter                   â”‚
â”‚                                     â”‚
â”‚  [Code â–¼]  [Add file â–¼]  [<> Code] â”‚  â† Click here
â”‚             â””â”€ Create new file      â”‚  â† Then this
â”‚             â””â”€ Upload files         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Step 2: Type the path**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ backlink-reporter /                                 â”‚
â”‚ [.github/workflows/monthly_report.yml        ]      â”‚
â”‚  â””â”€ Type this exactly! Note the dot at start       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Step 3: Paste the code**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit new file                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ name: Monthly Backlink Report                   â”‚ â”‚
â”‚ â”‚                                                 â”‚ â”‚
â”‚ â”‚ on:                                             â”‚ â”‚
â”‚ â”‚   schedule:                                     â”‚ â”‚
â”‚ â”‚     - cron: '0 9 1 * *'                        â”‚ â”‚
â”‚ â”‚   workflow_dispatch:                            â”‚ â”‚
â”‚ â”‚ ...                                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **âš ï¸ Common Mistakes**

### **Mistake #1: Missing the dot**
âŒ Wrong: `github/workflows/monthly_report.yml`
âœ… Right: `.github/workflows/monthly_report.yml`

### **Mistake #2: Wrong file extension**
âŒ Wrong: `monthly_report.yaml` (with 'a')
âœ… Right: `monthly_report.yml` (without 'a')

### **Mistake #3: Wrong location**
âŒ Wrong: `workflows/monthly_report.yml` (missing .github folder)
âœ… Right: `.github/workflows/monthly_report.yml`

### **Mistake #4: Typo in folder name**
âŒ Wrong: `.github/workflow/monthly_report.yml` (missing 's')
âœ… Right: `.github/workflows/monthly_report.yml` (with 's')

---

## **ğŸ” How to Know It's Working**

After you commit the workflow file:

1. **Check for "Actions" tab:**
   - Look at the top menu of your repository
   - You should see: `Code | Issues | Pull requests | Actions`
   - If "Actions" appears, your workflow is recognized! âœ…

2. **Click the Actions tab:**
   - You should see "Monthly Backlink Report" listed
   - Click on it
   - You'll see a "Run workflow" button

3. **Test it immediately:**
   - Click "Run workflow" (dropdown)
   - Click "Run workflow" (button)
   - Watch it run (takes 2-3 minutes)

---

## **ğŸ› Troubleshooting**

### **Problem: "Actions" tab doesn't appear**

**Solution 1:** Make sure Actions are enabled
- Go to Settings â†’ Actions â†’ General
- Select "Allow all actions and reusable workflows"
- Click "Save"

**Solution 2:** Check file location
- The file MUST be at `.github/workflows/monthly_report.yml`
- Click on your repository root
- You should see a `.github` folder
- Inside that, a `workflows` folder
- Inside that, your `monthly_report.yml` file

**Solution 3:** Check for syntax errors
- YAML is sensitive to indentation
- Make sure you copied the entire code block
- No extra spaces at the beginning of lines

### **Problem: Workflow runs but fails**

This is okay for now! It will fail until you:
1. Add all the Python scripts
2. Add the secrets (API keys)
3. Create the `requirements.txt` file

---

## **ğŸ“‹ Order of File Creation**

To avoid errors, create files in this order:
```
1. requirements.txt                    â† First (simplest)
2. config/settings.py                  â† Second (configuration)
3. scripts/collect_data.py             â† Third (data collection)
4. scripts/generate_report.py          â† Fourth (report generation)
5. scripts/send_email.py               â† Fifth (email sending)
6. .github/workflows/monthly_report.yml â† Last (automation)
